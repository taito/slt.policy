Log in as Manager::

    >>> browser.login(TEST_USER_NAME, TEST_USER_PASSWORD)

Assign cart portlet and member portlet::

    >>> browser.open('/++contextportlets++plone.leftcolumn/+/collective.cart.core.CartPortlet')
    >>> browser.open('/++contextportlets++plone.leftcolumn/+/slt.portlet.MemberPortlet')

Log out::

    >>> browser.getLink('Log out').click()

    >>> browser.open('/')
    >>> print browser.bycss('.portletMember')
    --- 1 ---
    <dl class="portlet portletMember"><dd class="portletItem">
    <ul><li>
    <a href="http://www.sll.fi/" title="The Finnish Association for Nature Conservation">The Finnish Association for Nature Conservation</a>
    </li>
    <li>
    <a href="http://nohost/plone/login" title="Log in">Log in</a>
    </li>
    </ul></dd>
    </dl>

Log in as member1::

    >>> browser.login('member1', 'member1')
    >>> browser.url
    'http://nohost/plone/@@personal-information'
    >>> print browser.bycss('.info')
    --- 1 ---
    ...
    --- 2 ---
    <dl class="portalMessage info"><dt>Info</dt>
    <dd>Please fill your personal information.</dd>
    </dl>

Go to portal top::

    >>> browser.open('/')

Link to Personal Information should be there::

    >>> print browser.bycss('#personaltools-information')
    --- 1 ---
    <li id="personaltools-information">
    <a href="http://nohost/plone/@@personal-information">Personal Information</a>
    </li>

Link to Preferences should not be there::

    >>> print browser.bycss('#personaltools-preferences')

Visiting dashboard::

    >>> browser.open('/dashboard')
    >>> 'Insufficient Privileges' in browser.contents
    True

Visiting @@manage-dashboard::

    >>> browser.open('/@@manage-dashboard')
    >>> 'Insufficient Privileges' in browser.contents
    True

Visiting @@personal-preferences::

    >>> browser.open('/@@personal-preferences')
    >>> 'Insufficient Privileges' in browser.contents
    True

Go to Personal Information and add informations::

    >>> browser.getLink('Personal Information').click()
    >>> browser.getControl(name="form.fullname").value = 'Fırst Läst'
    >>> browser.getControl(name="form.email").value = 'first.last@email.com'
    >>> browser.getControl(name="form.registration_number").value = 'REGISTRÄTIÖN12345'
    >>> browser.getControl(name="form.actions.save").click()

Go to Orders::

    >>> browser.getLink('Orders').click()
    >>> browser.url
    'http://nohost/plone/Members/member1'
    >>> print browser.bycss('.documentFirstHeading')
    --- 1 ---
    <h1 class="documentFirstHeading">Order Linsting</h1>

    >>> print browser.bycss('.documentDescription')
    --- 1 ---
    <div class="documentDescription">Add commonly used addresses to make your order easier.</div>

Go to article1::

    # >>> browser.getLink('Log out').click()
    # >>> browser.login(TEST_USER_NAME, TEST_USER_PASSWORD)

    >>> browser.open('/article1')

Add Ärticle1 to cart::

    >>> browser.getControl(name="form.buttons.AddToCart").click()

Go to cart::

    >>> browser.getLink('Go to cart').click()

Check out::

    >>> browser.getControl(name="form.buttons.CheckOut").click()
    >>> 'value="Fırst"' in browser.contents
    True
    >>> 'value="Läst"' in browser.contents
    True
    >>> 'value="first.last@email.com"' in browser.contents
    True
    >>> print browser.bycss('.portletCart')
    --- 1 ---
    <dl class="portlet portletCart"><dd class="portletItem">
    <table><tbody><tr><td id="go-to-cart">
    <a href="http://nohost/plone/@@cart">Go to cart</a>
    </td>
    <td id="article-count">
    1
    </td>
    </tr></tbody></table></dd>
    </dl>

Fill Billing Info and select Shipping Methöd 2::

    >>> browser.getControl(name="billing_first_name").value = 'Bılling First'
    >>> browser.getControl(name="billing_last_name").value = 'Bılling Last'
    >>> browser.getControl(name="billing_organization").value = 'Bılling Organization'
    >>> browser.getControl(name="billing_vat").value = 'Bılling VAT'
    >>> browser.getControl(name="billing_email").value = 'first.last@email.bil'
    >>> browser.getControl(name="billing_street").value = 'Bılling Street'
    >>> browser.getControl(name="billing_post").value = 'Bılling Post'
    >>> browser.getControl(name="billing_city").value = 'Bılling City'
    >>> browser.getControl(name="billing_phone").value = 'Bılling Phone'
    >>> browser.getControl(name="shipping-method").value = [shippingmethod2_uuid]
    >>> browser.getControl(name="form.buttons.CheckOut").click()

Confirm order::

    >>> browser.getControl(name="form.buttons.CheckOut").click()

Check the newest message sent::

    >>> len(mailhost.messages)
    2

    >>> msg = mailhost.messages[-2]
    >>> prink(msg)
    MIME-Version: 1.0
    Content-Type: text/plain; charset="utf-8"
    Content-Transfer-Encoding: quoted-printable
    Subject: =?utf-8?q?Order_Number=3A_1?=
    To: =?utf-8?q?B=C4=B1lling_First_B=C4=B1lling_Last?= <first.last@email.bil>
    From: Luonnonsuojelukauppa <info@shop.com>
    Date: ...
    <BLANKLINE>
    Thank you for the order.
    <BLANKLINE>
    <BLANKLINE>
    Order Number: 1
    <BLANKLINE>
    <BLANKLINE>
    Registration Number: REGISTR=C3=84TI=C3=96N12345
    <BLANKLINE>
    <BLANKLINE>
    Billing Address
    =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
    =3D=3D=3D
    B=C4=B1lling First B=C4=B1lling Last  B=C4=B1lling Organization  B=C4=B1lli=
    ng VAT
    B=C4=B1lling Street
    B=C4=B1lling Post B=C4=B1lling City
    B=C4=B1lling Phone
    first.last@email.bil
    <BLANKLINE>
    Shipping Address
    =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
    =3D=3D=3D
    B=C4=B1lling First B=C4=B1lling Last  B=C4=B1lling Organization  B=C4=B1lli=
    ng VAT
    B=C4=B1lling Street
    B=C4=B1lling Post B=C4=B1lling City
    B=C4=B1lling Phone
    first.last@email.bil
    <BLANKLINE>
    <BLANKLINE>
    Order Contents
    =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
    =3D=3D=3D
    <BLANKLINE>
    SKU: SK=C3=961
    =C3=84rticle1 x 1 =3D 12.40 =E2=82=AC
    <BLANKLINE>
    <BLANKLINE>
    Shipping Method: ShippingMeth=C3=B6d2
    <BLANKLINE>
    Total: 12.40 =E2=82=AC
    <BLANKLINE>
    Link to the order: http://nohost/plone/Members/member1?order_number=3D1
    <BLANKLINE>
    <BLANKLINE>

    >>> msg = mailhost.messages[-1]
    >>> prink(msg)
    MIME-Version: 1.0
    Content-Type: text/plain; charset="utf-8"
    Content-Transfer-Encoding: quoted-printable
    Subject: =?utf-8?q?Order_Number=3A_1?=
    To: Luonnonsuojelukauppa <info@shop.com>
    From: Luonnonsuojelukauppa <info@shop.com>
    Date: ...
    <BLANKLINE>
    <BLANKLINE>
    <BLANKLINE>
    <BLANKLINE>
    Order Number: 1
    <BLANKLINE>
    <BLANKLINE>
    Registration Number: REGISTR=C3=84TI=C3=96N12345
    <BLANKLINE>
    <BLANKLINE>
    Billing Address
    =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
    =3D=3D=3D
    B=C4=B1lling First B=C4=B1lling Last  B=C4=B1lling Organization  B=C4=B1lli=
    ng VAT
    B=C4=B1lling Street
    B=C4=B1lling Post B=C4=B1lling City
    B=C4=B1lling Phone
    first.last@email.bil
    <BLANKLINE>
    Shipping Address
    =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
    =3D=3D=3D
    B=C4=B1lling First B=C4=B1lling Last  B=C4=B1lling Organization  B=C4=B1lli=
    ng VAT
    B=C4=B1lling Street
    B=C4=B1lling Post B=C4=B1lling City
    B=C4=B1lling Phone
    first.last@email.bil
    <BLANKLINE>
    <BLANKLINE>
    Order Contents
    =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
    =3D=3D=3D
    <BLANKLINE>
    SKU: SK=C3=961
    =C3=84rticle1 x 1 =3D 12.40 =E2=82=AC
    <BLANKLINE>
    <BLANKLINE>
    Shipping Method: ShippingMeth=C3=B6d2
    <BLANKLINE>
    Total: 12.40 =E2=82=AC
    <BLANKLINE>
    Link to the order: http://nohost/plone/tilaukset/1
    <BLANKLINE>
    <BLANKLINE>

Thanks page::

    >>> print browser.bycss('#link-to-order')
    --- 1 ---
    <section id="link-to-order"><a href="http://nohost/plone/Members/member1?order_number=1">Check the order</a>
    </section>


Check the order::

    >>> browser.getLink('Check the order').click()
    >>> print browser.bycss('#order-listing')
    --- 1 ---
    <section id="order-listing"><dl class="collapsible"><dt class="collapsibleHeader">
    <span class="order-number">Order Number: 1</span>
    <span class="order-state">
    State:
    Ordered</span>
    <span class="order-updated">Updated: ...</span>
    </dt>
    <dd class="collapsibleContent">
    <section id="order-articles"><table><tbody><tr><td class="image">
    <a href="http://nohost/plone/article1" title="&#196;rticle1">
    <img src="http://nohost/plone/fallback.png"></a>
    </td>
    <td class="name">
    <h3>
    <a href="http://nohost/plone/article1">&#196;rticle1</a>
    </h3>
    <p></p>
    </td>
    <td class="price-and-quantity">
    <span class="gross">12.40 &#8364;</span>
    <br><span class="vat">Including VAT: 24%</span>
    </td>
    </tr></tbody></table></section><section id="shipping-method"><table><tbody><tr><td class="shipping-method-title">Shipping Method:</td>
    <td>ShippingMeth&#246;d2</td>
    <td class="price-and-quantity">
    </td>
    </tr></tbody></table></section><section id="order-total"><span>Total</span>&#160;&#160;
    <span id="total">12.40 &#8364;</span>
    </section><dl id="registration-number"><dt>Registration Number</dt>
    <dd>REGISTR&#196;TI&#214;N12345</dd>
    </dl><section id="addresses"><dl><dt>Billing Address</dt>
    <dd>
    B&#305;lling First&#160;B&#305;lling Last&#160;&#160;B&#305;lling Organization&#160;&#160;B&#305;lling VAT<br>
    B&#305;lling Post&#160;B&#305;lling City<br>
    B&#305;lling Phone<br>
    first.last@email.bil<br></dd>
    </dl><dl><dt>Shipping Address</dt>
    <dd>
    B&#305;lling First&#160;B&#305;lling Last&#160;&#160;B&#305;lling Organization&#160;&#160;B&#305;lling VAT<br>
    B&#305;lling Post&#160;B&#305;lling City<br>
    B&#305;lling Phone<br>
    first.last@email.bil<br></dd>
    </dl></section></dd>
    </dl></section>
